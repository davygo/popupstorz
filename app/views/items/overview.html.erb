<%= render :partial => "items_header" %>
<div class="clear"></div>
<br/>

<div id="get-list-header">
  <h2>The Offers you got</h2>
</div>

<div class="listx-bg">
  <% unless @offers.blank? %>
  <%#*<div class="btn-bar" style="margin-bottom: 10px;border-bottom: 1px solid gray;padding: 10px;">%>
  <%#= link_to 'Messages', inbox_messages_path %>
  <%#= link_to 'My Listings',items_path %>
  <%#= link_to 'My Pop Ups',"#" %>
  <%#= link_to('My Profile', profile_path(current_user.id)) %>
  <%#= link_to "My Account","#" %>
  <%#*</div>%>

    <% @offers.each do | offer | %>
      <%item=offer.item%>

      <div class="listx" style="margin-bottom: 10px;border-bottom: 1px solid gray;padding: 10px;">

        <div class="imgx">
    <%#=  check_box_tag "items[]", item.id, false, {:id => "items_#{item.id}", :class => "checkBoxClass", :onclick => "defineDelete();"} %>
          <% if item.avatars.size > 0 %>
            <%= image_tag(item.avatars.first.photo.url(:thumb), :width => "115", :height => "81", :alt => "Space-Photo")  %>
          <% else %>
            NO IMAGE PROVIDED YET.
          <% end %>
        </div>

        <div class="name-list" style="margin-bottom: 5px;"><h4><%= item.title %></h4></div>
        <div class="name-list" style="margin-bottom: 5px;"><b>Location: </b><%= item.address %></div>
        <% joined = GatheringMember.where("status = 'Approved' and offer_id = #{offer.id}") %>

        <div class="name-list" style="margin-bottom: 5px;">
          <b>Price: </b>
          <%= number_to_currency(exchange_currency(item.price.to_i, item.price_unit), :unit => session[:curr] == "USD" ? "$" : "€", :precision => 0)%>/day,
          <%= number_to_currency(exchange_currency(item.price_per_week.to_i, item.price_unit), :unit => session[:curr] == "USD" ? "$" : "€", :precision => 0)%>/week,
          <%= number_to_currency(exchange_currency(item.price_per_month.to_i, item.price_unit), :unit => session[:curr] == "USD" ? "$" : "€", :precision => 0)%>/month.
        </div>
        <div>
          Your Offer: <%= number_to_currency(exchange_currency(offer.total_amount.to_i, item.price_unit), :unit => session[:curr] == "USD" ? "$" : "€", :precision => 0)%>
          <br/>
          Status:
          <% if offer.status == "Accepted - Payment pending" or offer.status == "all joinings approved" or offer.status == "Accepted - Confirmation pending" or offer.status == "joinings approved" or offer.status == "Applied" or offer.status == "confirmed" %>
            <% if joined.size.to_i < offer.persons_in_gathering.to_i or offer.cancellation_date.blank? %>
              <%= "Creating" %>
            <% else %>
              <%= "Applied" %>
            <% end %>
          <% else %>
            <%= offer.status %>
          <% end %>
          <%if offer.status=="Accepted - Payment pending" && offer.item.user_id != current_user.id %>
            <form METHOD="LINK" ACTION="/items/payment_charge/<%=offer.id%>">
              <input TYPE="submit" VALUE="check in">
            </form>
          <%end%>
        </div> <%if offer.is_gathering or offer.persons_in_gathering.to_i > 0%>
          Gathering Description: </b><%= offer.gathering_description %> <%end%> <br/>
        <b>Time:</b> <%= offer.rental_start_date.strftime("%m-%d-%Y") %> - <%= offer.rental_end_date.strftime("%m-%d-%Y") %>
        <br/>

        <b> Response required before</b>
        <% if offer.is_gathering or offer.persons_in_gathering.to_i > 0 %>
          <%= offer.gathering_deadline.strftime("%m-%d-%Y") %>
        <% else %> 
          <%= offer.cancellation_date.strftime("%m-%d-%Y") %>
        <% end %><br/>

        <div style="float:left;width:100%;">
          <h1 class="size">Owner Rules:</h1><br />
          <div style="float:left;cursor: pointer;font-size: 12px;" onclick="$('#rules_div_<%= offer.id %>').toggle()">Show Details</div><br />
          <p class="size_text" id="rules_div_<%= offer.id %>" style="display:none;">
            <%= item.owner_rules.blank? ? "" : nl2br(item.owner_rules).html_safe %>
          </p>
          <div class="clear"></div>

          <h1 class="size">Cancellation Policy:</h1><br />
          <div style="float:left;cursor: pointer;font-size: 12px;" onclick="$('#policy_div_<%= offer.id %>').toggle()">Show Details</div><br />
          <p class="size_text" id="policy_div_<%= offer.id %>" style="display:none;">
            <% unless item.cancellation_policy_flexible.blank? %>
              Flexible<br/>
              If renter cancels more than 7 days before booking start date: full refund<br/>
              If renter cancels less than 7 days before booking start date: no refund<br/><br/>

              Exemple : If renter wishes to cancel a reservation that starts on a Friday, cancellation will have to be done before the Thursday of the prior week at 23:59 (local time of the booked space).<br/><br/>

              Please be informed that the 10% Pop Up Storz service fee is not refundable.<br/><br/>
              Exemple
              If renter has done a booking for an amount of 110 € and cancels more than 7 days before booking start date, the amount of the refund will be 100 €.<br/><br/>
            <% else %>
              SemiFlexible<br/>
              If renter cancels more than 3 days before booking start date: partial refund (50%)<br/>
              If renter cancels less than 3 days before booking start date: no refund<br/><br/>

              Exemple : If renter wishes to cancel a reservation that starts on a Friday, cancellation will have to be done before the prior Monday at 23:59 (local time of the booked space).<br/><br/>

              Please be informed that the 10% Pop Up Storz service fee is not refundable. <br/><br/>
              Exemple
              If renter has done a booking for an amount of 110 € and cancels more than 3 days before booking start date, the amount of the refund will be 50 €.<div/>
          <% end %>
          </p>
          <div class="clear"></div>
          <br />
        </div>
      </div>


      <%= link_to "Details", "/offers/#{offer.id}" %><br/>

      <% unless offer.status == "Approved" or offer.status == "Accepted" or offer.status == "confirmed" or offer.status == "Confirmed" or offer.status == "Declined" or offer.status == "Cancelled" %>
        <%= link_to "Approve", "/accept_gathering/#{offer.id}?mem=#{offer.user.id}" %> | 
        <%= link_to "Decline", "/reject_gathering/#{offer.id}?mem=#{offer.user.id}&item_id=#{offer.item.id}" %>
      <% end %>
      <% if offer.persons_in_gathering.blank? and (offer.status == "confirmed") %>
        <%= link_to "Approve", "/accept_gathering/#{offer.id}?mem=#{offer.user.id}" %> | 
        <%= link_to "Decline", "/reject_gathering/#{offer.id}?mem=#{offer.user.id}&item_id=#{offer.item.id}" %>
      <% end %>

      <br />
      <% if (offer.status == "Confirmed") && current_user.id == offer.owner_id && offer.rental_start_date.to_date > Date.parse("#{Date.today}","%Y-%d-%m") %>     
        <%= link_to "Cancel Booking", "/cancel_booking/#{offer.id}" %>
      <% end %>

    </div>
  <%end%>
<%else%>
  You don't currently have any offers listed with PopupStorz.
<%end%>
</div>

<script>
  function defineDelete(){
    isChecked = "false";
    jQuery(".checkBoxClass").each(function(){
      alert($(this).checked);
      if($(this).checked == "checked"){
        isChecked = "true";
      }
    });
    if(isChecked == "true"){
      alert('showDelete');

    }else{
      alert('hideDelete');
    }
  }
</script>