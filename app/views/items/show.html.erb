<noscript>
  <style>
    .es-carousel ul{
      display:block;
    }
  </style>
</noscript>
<script id="img-wrapper-tmpl" type="text/x-jquery-tmpl">
  <div class="rg-image-wrapper">
				{{if itemsCount > 1}}
    <div class="rg-image-nav">
      <a href="#" class="rg-image-nav-prev">Previous Image</a>
      <a href="#" class="rg-image-nav-next">Next Image</a>
    </div>
				{{/if}}
    <div class="rg-image"></div>
    <div class="rg-loading"></div>
    <div class="rg-caption-wrapper">
      <div class="rg-caption" style="display:none;">
        <p></p>
      </div>
    </div>
  </div>
</script>
<script type='text/javascript'>//<![CDATA[
  $(window).load(function(){
    $(document).ready(function(){
      $("#txtFromDate").datepicker({minDate: new Date()});
      $("#txtToDate").datepicker({minDate: new Date()});
    });
  });//]]>
</script>

<a href='#' class="back " onclick='history.back();'>&lt;&lt; Back to results</a>
<div class="leftcontent">
  <div class="shadowCont">
    <div class="fltL">
      <h1 class="charming"><%= @item.title %>!</h1>
      <h6><%= link_to "(Edit this Item)", edit_item_path(@item) if (current_user && @item.user.email == current_user.email)%></h6>
      <%= link_to "Delete this Item", item_path(@item), :method => :delete, :confirm => "Are you sure?"  if (current_user && @item.user.email == current_user.email)%>

      <p class="charming_text"><%= @item.address %>(<%= @item.zipcode %> - <%= @item.city %>, <%= @item.country_code   %>)</p>
    </div>
    <div class="fltR">
      <h1 class="charming graytext">
        <%= number_to_currency(exchange_currency(@item.price.to_i, @item.price_unit), :unit => session[:curr] == "USD" ? "$" : "€", :precision => 0) %></h1>
      <p class="charming_text graytext"><%=  @item.time_for_unit_price %></p>
    </div>
    <div class="clear"></div>
    <% unless @item.avatars.size > 0 %>
      <img src="../assets/gallery.png"alt="" class="gallery" />
    <% else %>
      <div id="rg-gallery" class="rg-gallery">
        <div class="rg-thumbs">
          <!-- Elastislide Carousel Thumbnail Viewer -->
          <div class="es-carousel-wrapper">
            <div class="es-nav">
              <span class="es-nav-prev">Previous</span>
              <span class="es-nav-next">Next</span>
            </div>
            <div class="es-carousel">
              <ul>
                <% @item.avatars.each do |avatar| %>
                  <li>
                    <a href="#">
                      <img src="<%= avatar.photo.url(:thumb) %>"
                           data-large="<%= avatar.photo.url(:original) %>"
                           alt="image01"
                           data-description="<%= @item.title %>" />
    <%#= image_tag(, :alt=>"", :width => "471px",:height=>"391px", :class => "gallery") %>
                    </a>
                  </li>
                <% end %>
              </ul>
            </div>
          </div>
          <!-- End Elastislide Carousel Thumbnail Viewer -->
        </div><!-- rg-thumbs -->
      </div><!-- rg-gallery -->
    <% end %>


    <div class="fltR w200 mt100" style="width: 165px;margin-top: 110px;">
      <h1 class="size">Size:</h1>
      <p class="size_text"><%= @item.size %> <%= @item.size_unit %></p>
      <div class="clear"></div>
      <h1 class="size">Type:</h1>
      <p class="size_text"><%= @item.listing_type.name %></p>
      <div class="clear"></div>
      <h1 class="size">Number of floors:</h1>
      <p class="size_text"></p>
      <div class="clear"></div>
      <h1 class="size">Cleaning Fee:</h1>
      <p class="size_text"><%= number_to_currency(exchange_currency(@item.cleaning_fee.to_i, @item.price_unit), :unit => session[:curr] == "USD" ? "$" : "€", :precision => 0) %>
      </p>
      <div class="clear"></div>
      <h1 class="size">Deposit Fee:</h1>
      <p class="size_text"><%= number_to_currency(exchange_currency(@item.deposit.to_i, @item.price_unit), :unit => session[:curr] == "USD" ? "$" : "€", :precision => 0) %></p>
      <div class="clear"></div>
      <h1 class="size">Available from:</h1>
      <p class="size_text"><%= @item.availability_from.strftime("%m-%d-%Y") %></p>
      <div class="clear"></div>
      <h1 class="size">Available to:</h1>
      <p class="size_text"><%= @item.availability_to.strftime("%m-%d-%Y") %></p>
      <div class="clear"></div>
      <h1 class="size">Gathering Available:</h1>
      <p class="size_text">
        <% if (@item.is_shareable == true) then %>Upto
          <%= @item.maximum_members %> persons
        <%else%>
          NO
        <%end%>  </p>
      <div class="clear"></div>
    </div>
    <div class="clear"></div><br/>

    <div id="favorite_div_<%= @item.id %>">
      <%= render :partial => "favorite", :locals => {:item => @item} %>
    </div>

    <p class="charming_text mt30"><%= @item.description %></p>

    <div class="line"></div>

    <h1 class="charming">what other people think</h1>
    <p class="charming_text">what other people thinkwhat other people thinkwhat other people thinkwhat other people think</p>
    <div class="line"></div>
    <div id="comments" style="height: 200px;">

      <%= form_for @comment, :url => "/items/add_comment" do |f| %>
        <% if @comment.errors.any? %>
          <div id="errorExplanation" class="erro_messages">
            <h2>Oops! Looks like you need to include the following:</h2>
            <ul>
              <li style="list-style: square;float: left;">
                <%= @comment.errors.full_messages.to_sentence  %>
              </li>
            </ul>
          </div>
        <% end %>
        <%= hidden_field_tag "id",@item.id %>
        <div class="field">
          <%= f.label :title %><br/>
          <%= f.text_field "title" %>
        </div>
        <div class="field">
          <%= f.label :comment %><br />
          <%= f.text_area "comment", :rows => 5 %><br />

          <a class="search ml70" onclick="$('#new_comment').submit();" href="#">Leave Comment</a>
        </div>
      <% end %>
    </div>
    <br/><br/>
<%#if current_user%>
    <div id="show_comments" >
      <b>Previous Comments:</b><br/>
      <%unless @item.comments.blank? %>
        <%@item.comments.each do|f|%>
          <b><%=f.title  %></b><br/>
          <%= f.comment %><br/>
          <i><%= f.user.first_name %> at <%= f.created_at.strftime("%Y-%m-%d %H:%M:%S") %></i>
          <br/>
          <br/>
        <%end%>
      <%end%>
    </div>
    <div id="rating_of_item_<%= @item.id %>">
       <%= render :partial => "/ratings/rating", :locals => { :asset => @item, :only_view => false } %>
    </div>

<%#end%>
  </div>
</div>


<div class="fltR">
  <div class="shadowCont w212">
    <div class="fltL">
      <% if @item.user.avatars.size > 0 %>
        <%= image_tag(@item.user.avatars.first.photo.url(:thumb), :height => "56", :alt => "Seller-Image" )%>
      <% else %>
        <%= image_tag("User.png", :height => "56") %>
      <% end %>
    </div>
    <div class="fltR w107">

<%#       *<img src="../assets/rating.png" alt="" />%>
     
      <h1 class="name"><%= @item.user.popup_storz_display_name %></h1>
      <p class="name_text"><%= @item.user.country %></p>
      <% if current_user != @item.user %>
        <div id="store-btn">
          <%= link_to_function "Contact Me", "$('#contact_me_div').toggle('slow');", :class => "send"  %>
        </div>
      <% end %>

      <div style="float: left;width: 100%;margin-top: 10px;display: none;" id="contact_me_div">
        <%= form_tag contact_me_messages_path , :html => {:id => "contact_me_form"}, :remote  => true do %>
          <%= hidden_field_tag :topic, "Inquiry" %>
          <%= hidden_field_tag :user_id, @item.user.id %>
          <span style="width: auto;float: left;">
            <%= text_area_tag  :body, "", :style => "width:118px;height:100px;" %>
          </span>
          <div style="float: left;margin-top: 5px;">
            <%= submit_tag "Send" %>&nbsp;&nbsp;&nbsp;<%= link_to_function "Cancel", "$('#contact_me_div').toggle('slow');"  %>
          </div>
        <% end %>
      </div>
    </div>
    <div class="clear"></div>
  </div>

  <div class="shadowCont w212 mt30">
    <h1 class="available">Availabilities</h1>
    <div id="box-bookit">
      <%= form_tag new_item_offer_path(@item.id), :method => :get  , :id => "book_it_form", :onsubmit => "return check_dates();" do  %>
        <div id="pricing" style="margin-top: 10px;">
          <div class="price_to_book" >
            <span id="price"  style="float: left;width: 110px;">
              <%= number_to_currency(exchange_currency(@item.price.to_i, @item.price_unit), :unit => session[:curr] == "USD" ? "$" : "€", :precision => 0) %>
            </span>
            <span style="float: left;">
              <select name="price_per_span" onchange="change_price_to_book($(this));">
                <option value="<%= number_to_currency(exchange_currency(@item.price.to_i, @item.price_unit), :unit => session[:curr] == "USD" ? "$" : "€", :precision => 0) %>">Per day</option>
                <option value="<%= number_to_currency(exchange_currency(@item.price_per_week.to_i, @item.price_unit), :unit => session[:curr] == "USD" ? "$" : "€", :precision => 0) %>">Per week</option>
                <option value="<%= number_to_currency(exchange_currency(@item.price_per_month.to_i, @item.price_unit), :unit => session[:curr] == "USD" ? "$" : "€", :precision => 0) %>">Per month</option>
              </select>
              <%= hidden_field_tag :per_day_price, @item.price %>
              <%= hidden_field_tag :per_week_price, @item.price_per_week %>
              <%= hidden_field_tag :per_month_price, @item.price_per_month %>
            </span>
          </div>

  <%#*<div class="clear"></div>%>
        </div>
        <div id="r-date">
          <div id="pickup" style="margin-top: 10px;float: left;">
            <span style="float: left;width: 60px;">
              <label>Pick up</label>
            </span>
            <span style="float: left;width: 140px;">
              <input type="text" value="mm/dd/yy" name="pick_up" id="txtFromDate" onchange ="calculateTotalAmount();" size="15" />
            </span>
          </div>
          <div id="return"  style="margin-top: 10px;float: left;">
            <span style="float: left;width: 60px;">
              <label>Return</label>
            </span>
            <span style="float: left;width: 140px;">
              <input type="text" value="mm/dd/yy"  name="return" id="txtToDate" onchange ="calculateTotalAmount();" size="15" />
            </span>
          </div>
          <div class="clear"></div>
        </div>

        <div id="r-date">
          <div id="pickup" style="margin-top: 10px;float: left;">
            <span style="float: left;width: 100px;">
              <label>Total Days</label>
            </span>
            <span style="float: left;width: 100px;">
              <div id="total_days" class="price_to_book" style="margin-left: 10px;font-size: 14px;">0 &nbsp;days</div>
            </span>
          </div>
          <div id="return"  style="margin-top: 10px;float: left;">
            <span style="float: left;width: 100px;">
              <label>Total Price</label>
            </span>
            <span style="float: left;width: 100px;">
              <div id="total_price" class="price_to_book" style="margin-left: 10px;font-size: 14px;">0 &nbsp;€</div>
            </span>
          </div>
          <div class="clear"></div>
        </div>

        <div id="submit-book">
          <% if @item.item_status == "Available" %>
            <% unless (@item.user == current_user) %>
              <a href="#" onclick="$('#book_it_form').submit();" class="search ml70"> Book it </a>
            <% else %>
              <a href="#" onclick="alert('You are owner, You can not book it, Thanks.');return false;" class="search ml70">Book it</a>
            <% end %>
          <% else %>
            <a href="#" onclick="alert('Item is already Reserved and not Available, Thanks.');return false;" class="search ml70"> Reserved </a>
          <% end %>
        </div>
      <% end %>
    </div>


    <div class="clear"></div>
  </div>



</div>

<div class="clear"></div>



<script type="text/javascript">
  function send_rating(rating_url, mode){
    jQuery.ajax({
      type:"GET",
      url: rating_url,
      data: ({'rate': true }),
      beforeSend: function (response) {
        jQuery('#'+mode+'_ajax_loader').show();
      },
      success: function (response) {
        jQuery("div #rating_<%= @item.id %>").html(response);
        jQuery('#'+mode+'_ajax_loader').hide();

      }
    });
  }
</script>



<script type="text/javascript">
  function change_price_to_book(elem){
    $('#price').html(elem.val());
  }
  function check_dates(){
    if($('#txtFromDate').val() == "" || $('#txtFromDate').val() == "mm/dd/yy" || $('#txtToDate').val() == "" || $('#txtToDate').val() == "mm/dd/yy" ){
      alert('Please select right date');
      return false;
    }else{
      return true;
    }
  }
</script>

<script>
  function calculateTotalAmount(){
    $("#txtToDate").datepicker('option', 'minDate', new Date($("#txtFromDate").val()));

    if($("#txtFromDate").val()=="mm/dd/yy"){
      alert('Please select pickup date first, thanks.');
      $("#txtToDate").val("mm/dd/yy");
    }
    else
    {
      if($("#txtToDate").val()=="")
      {
        $("#txtToDate").val($("#txtFromDate").val());
      }
    }

    if($('#txtFromDate').val() != 'mm/dd/yy' && $('#txtToDate').val() != 'mm/dd/yy'){
      start = $('#txtFromDate').val();
      start_date = new Date(start);
      end = $('#txtToDate').val();
      end_date = new Date(end);

      number_of_days = (end_date - start_date)/(1000*60*60*24);
      if(number_of_days == 0){
        number_of_days = 1;
      }

      $('#total_days').text(number_of_days+ " days");
      $('#total_price').text(calculate_price(number_of_days)+ " €");
    }
  }
  function calculate_price(number_of_days){
    months = Math.floor(number_of_days/30);
    weeks = Math.floor((number_of_days - (Math.floor((30 * months))))/7);
    days = (number_of_days - (30 * months)) - (weeks * 7);
    return months * $('#per_month_price').val()  + weeks * $('#per_week_price').val() + days * $('#per_day_price').val();
  }
</script>






<%#=  @item.availability_from.strftime("%d-%m-%Y %I:%M%p") %>
<%#=  @item.availability_to.strftime("%d-%m-%Y %I:%M%p") %>



<%#*</div>%>
<%#*</div>%>